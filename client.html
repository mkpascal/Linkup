<!DOCTYPE HTML>
<html>
	<head>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js" type="text/javascript"></script>
		<script src="http://jquery-json.googlecode.com/files/jquery.json-2.2.min.js"></script>
		<script src="http://jquery-websocket.googlecode.com/files/jquery.websocket-0.0.1.js"></script>
		<script type="text/javascript">
			function Start() {
				if ("WebSocket" in window) {
					var ws = new WebSocket("ws://192.95.22.227:8080");

					ws.onopen = function () {
						$('.typing').text("Connected! Waiting for a partner...");
					};

					ws.onmessage = function (evt) {
						var received_msg = evt.data;

				        var last = received_msg.substr(-1);
				        var first = received_msg.charAt(0);

/*
						if (received_msg == 1) {
							$('.typing').text("A is Typing... " + received_msg);
							$('.typing').toggle();
						};

						if (received_msg == 2) {
							$('.typing').text("B is Typing..." + received_msg);;
							$('.typing').toggle();
						};
*/

						if (received_msg == 3) {
							$('.typing').text("A partner has been found! Wait until he's done.");
						};

						if (received_msg == 4) {
							$('.typing').text("A partner has been found! Go ahead and type.");
							$('#message').show();
						};

						if (received_msg == 5) {
							$('.typing').text("Your partner is done typing. It's your turn!");
							$('#message').show();
						};

						if (received_msg == 6) {
							$('.typing').text("It's your partner turn. Please wait.");
							$('#message').hide();
						};

						if (received_msg == 7) {
							$('.typing').text("It's over now! Do you want to meet?");
							$('#message').hide();
						};

                        if(isNaN(received_msg)){

    						if (last != "#") {
    							//$('div.text').append(received_msg);
    							$('.typing').html("Typing... <a style='color:black !important;'>" + received_msg + "</a>");;
    							$('.typing').toggle();		
    						};
    						
    				        if (last == "#" && first == "~"){
    				        
    				            var trans = received_msg.substr(1, received_msg.length-2);
    				            
        						$('div.text').append(trans + "<br/>");
    				       };
				       
				       };

					};

					ws.onclose = function () {
						$('div.text').append("Server has closed the connection<br>");
					};


				}

				$('#message').keyup(function (e) {

					value = $('input[id=message]').val();
					ws.send(value);

					if (e.which == 13) {
						ws.send(value + "#");
						return false;
					}

				});

/*
  else
  {
     alert("You don't have Websocket! Go die.");
  }
  
*/

			}
			
		</script>
	</head>
	<body>
		<div id="container">
			<a href="javascript:Start()">Connect</a>
			<input id="message" type="text" style="display:none;" /><br/><br/>
			<div class="typing" style="font-weight:bold;color:blue;"></div>
			<div class="typing" style="color:blue;display:none;"></div><br/><br/>
			<div class="text"></div>
		</div>
		<script>
			
		</script>
	</body>

</html>